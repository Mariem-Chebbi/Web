{% extends 'base_back.html.twig' %}

{% block body %}
    <section class="contact-us" id="contact-section">

        <div class="container d-flex flex-column justify-content-center align-items-center" style="height: 100vh;">

            <style>
                h1.text-primary {
                    color: #1ab394;;
                    font-size: 28px;
                    text-align: center; /* Centrer le titre */
                    text-transform: uppercase; /* Mettre le texte en majuscules */
                    letter-spacing: 2px; /* Ajouter de l'espace entre les lettres */
                    font-weight: bold; /* Mettre en gras */
                    text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.3); /* Ajouter une ombre au texte */
                }

                .roles-inline label {
                    display: inline-block;
                    margin-right: 10px;
                / / adjust the spacing between the choices
                }

                button {
                    background-color: #1ab394;
                    border-color: #1ab394;
                    color: #1ab394;
                    padding: 5px 10px;
                    font-size: 14px;
                    font-weight: 400;
                    line-height: 1.5;
                    border-radius: 3px;
                }

                table {
                    border-collapse: collapse;
                    width: 100%;
                    max-width: 100%;
                    margin-bottom: 1rem;
                    background-color: #fff;
                    border: 1px solid #1ab394;
                }

                th,
                td {
                    padding: 0.75rem;
                    vertical-align: top;
                    border-top: 1px solid #1ab394;
                }

                th {
                    vertical-align: bottom;
                    border-bottom: 2px solid #1ab394;
                    background-color: #f2f2f2;
                }

                td {
                    background-color: transparent;
                }

                tr:nth-child(even) td {
                    background-color: #f9f9f9;
                }

                title {
                    text-align: right;
                }
            </style>

            <div class="container" style="margin-top: 70px;">
                <label for="search"></label>
                <div class="col-md-8 mx-auto">
                    <div class="row ">
                        <input type="text" id="search"
                               class="col-md-10 my-3 form-control rounded registration-input-box"
                               placeholder="Recherche un utilisateur ...">
                        <div class="col-md-2 my-3 sort-button text-center float-sm-right">
                            <ul class="list-unstyled mb-0">
                                <li class="list-inline-item mb-0 mr-5 shadow-sm">
                                    <select id="sort-select" class="p-2">
                                        <option value="" disabled selected>Trier par ..</option>
                                        <option value="0">Pas de tri</option>
                                        <option value="1">Email</option>
                                        <option value="2">Nom</option>
                                        <option value="3">Prenom</option>
                                    </select>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="ibox-content">
                    <div style="">
                        <div class="card">
                            <div class="card-body">
                                <center><h1 class="text-center mb-4 mt-0 text-primary">Liste des utilisateurs</h1>
                                </center>
                            </div>
                            <table>
                                <tr>
                                    <th>Id</th>
                                    <th>Email</th>
                                    <th>Roles</th>
                                    <th>Nom</th>
                                    <th>Prénom</th>
                                    <th>Numéro de téléphone</th>
                                    <th>Ville</th>
                                    <th>Date de naissance</th>
                                    <th>Image</th>
                                    <th>Action</th>
                                </tr>
                                <tbody id="table-body">
                                {% for i in User %}
                                    <tr>
                                        <td>{{ i.id }}</td>
                                        <td>{{ i.email }}</td>
                                        <td class="roles-inline">{{ i.roles ? i.roles|json_encode : '' }}</td>
                                        <td>{{ i.nom }}</td>
                                        <td>{{ i.prenom }}</td>
                                        <td>{{ i.numTel }}</td>
                                        <td>{{ i.ville }}</td>
                                        <td>{{ i.DateNaissance|date('Y-m-d') }}</td>
                                        <td><img src="{{ asset('images/' ~ i.image) }}"
                                                 style="width: 50px; height: auto;"/></td>
                                        <td>
                                            <div>
                                                <a href="{{ path('supprimerU', {'id': i.id}) }}"
                                                   class="main-button-gradient">Supprimer</a><br>
                                            </div>
                                            <div>
                                                <a href="{{ path('updatU', {'id': i.id}) }}"
                                                   class="main-button-gradient">Modifier</a>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                                <tbody id="table-body-search">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        let triSelect = $('#sort-select');
        $('document').ready(function () {
            triSelect.on('change', function () {
                    if (triSelect.val() !== "0") {
                        $("#table-body").hide();
                        $("#table-body-search").show().empty();
                        $.ajax({
                            type: 'GET',
                            url: "/user/sort/by-field",
                            data: {'sort-value': triSelect.val()},
                            success: function (users) {
                                $("#table-body-search").show().empty();
                                if (users) {
                                    $.each(users, function (i, user) {
                                        $("#table-body-search").append(
                                            "<tr>" +
                                            "   <td>" + user.id + "</td>" +
                                            "   <td>" + user.email + "</td>" +
                                            "   <td>" + user.roles + "</td>" +
                                            "   <td>" + user.nom + "</td>" +
                                            "   <td>" + user.prenom + "</td>" +
                                            "   <td>" + user.numTel + "</td>" +
                                            "   <td>" + user.ville + "</td>" +
                                            "   <td>" + user.DateNaissance + "</td>"+
                                            "</tr>"
                                        );
                                    })
                                }
                            }
                        })
                    } else {
                        $("#table-body-search").empty().hide()
                        $("#table-body").show();
                    }
                }
            )
        })

        let release = null;
        $("#search").keyup(function (e) {
            $("#table-body").hide();
            $("#table-body-search").show();
            clearInterval(release);
            release = setInterval(function () {
                let value = $("#search").val();
                if (value !== "") {
                    $.ajax({
                        type: 'GET',
                        url: "/user/recherche/by-email",
                        data: {
                            'search-value': value
                        },
                        success: function (users) {
                            if (users) {
                                $("#table-body-search").empty()
                                if (users.length) {
                                    $.each(users, function (i, user) {
                                            $("#table-body-search").append(
                                                "<tr>" +
                                                "   <td>" + user.id + "</td>" +
                                                "   <td>" + user.email + "</td>" +
                                                "   <td>" + user.roles + "</td>" +
                                                "   <td>" + user.nom + "</td>" +
                                                "   <td>" + user.prenom + "</td>" +
                                                "   <td>" + user.numTel + "</td>" +
                                                "   <td>" + user.ville + "</td>" +
                                                "   <td>" + user.DateNaissance + "</td>"+
                                                "   <td>" +
                                                "       <a href='' class='btn btn-primary w-100'>Afficher</a>" +
                                                "       <form method='post' action='' onsubmit='' class=''>" +//return confirm('Are you sure you want to delete this item?');
                                                "           <button class='btn btn-danger w-100 mt-3'>Supprimer</button>" +
                                                "       </form>" +
                                                "   </td>" +
                                                "</tr>"
                                            );
                                        }
                                    )
                                } else {
                                    $("#contenu-recherche").append(
                                        "<tr>" +
                                        "   <td colspan='9'>no records found</td>" +
                                        " </tr>"
                                    )
                                }
                            } else {
                                $("#contenaire-revues-for-search").show();
                                $("#contenu-revues-recherche").empty().append(
                                    "   <div class='section py-3'>" +
                                    "       <div class='text-center my-5'>" +
                                    "           <p class='font-weight-light'>Aucun resultat</p>" +
                                    "       </div>" +
                                    "   </div>"
                                );
                            }
                        }
                    });
                } else {
                    $("#table-body-search").empty().hide()
                    $("#table-body").show();
                }
                clearInterval(release)
            }, 500);
            return false;
        });
    </script>
{% endblock %}